### Password Reset API Testing
### Base URL
@baseUrl = http://localhost:5223
@email = admin@test.com
@token = your-token-here

### ============================================
### 1. Register a test user (if not exists)
### ============================================
POST {{baseUrl}}/api/auth/register
Content-Type: application/json

{
  "username": "testuser",
  "email": "{{email}}",
  "fullName": "Test User",
  "password": "Password123",
  "role": "DealerStaff"
}

### ============================================
### 2. Forgot Password - Email exists
### ============================================
POST {{baseUrl}}/api/auth/forgot-password
Content-Type: application/json

{
  "email": "{{email}}"
}

### Expected Response:
### {
###   "success": true,
###   "message": "If the email exists, a password reset link has been sent"
### }
### 
### Check console logs for reset link if SMTP not configured

### ============================================
### 3. Forgot Password - Email does not exist
### ============================================
POST {{baseUrl}}/api/auth/forgot-password
Content-Type: application/json

{
  "email": "notexist@test.com"
}

### Expected Response: Same success message (security)
### {
###   "success": true,
###   "message": "If the email exists, a password reset link has been sent"
### }

### ============================================
### 4. Reset Password - Valid token
### ============================================
### IMPORTANT: Replace {{token}} with actual token from email/console
POST {{baseUrl}}/api/auth/reset-password
Content-Type: application/json

{
  "token": "{{token}}",
  "newPassword": "NewPassword123"
}

### Expected Response:
### {
###   "success": true,
###   "message": "Password has been reset successfully"
### }

### ============================================
### 5. Reset Password - Invalid token
### ============================================
POST {{baseUrl}}/api/auth/reset-password
Content-Type: application/json

{
  "token": "invalid-token-xyz",
  "newPassword": "NewPassword123"
}

### Expected Response:
### {
###   "success": false,
###   "message": "Invalid or expired reset token"
### }

### ============================================
### 6. Reset Password - Token already used
### ============================================
### Try to use the same token again
POST {{baseUrl}}/api/auth/reset-password
Content-Type: application/json

{
  "token": "{{token}}",
  "newPassword": "AnotherPassword123"
}

### Expected Response:
### {
###   "success": false,
###   "message": "Invalid or expired reset token"
### }

### ============================================
### 7. Reset Password - Password too short
### ============================================
POST {{baseUrl}}/api/auth/reset-password
Content-Type: application/json

{
  "token": "{{token}}",
  "newPassword": "123"
}

### Expected Response:
### {
###   "success": false,
###   "message": "Password must be at least 6 characters"
### }

### ============================================
### 8. Login with new password
### ============================================
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "username": "testuser",
  "password": "NewPassword123"
}

### Expected Response:
### {
###   "success": true,
###   "message": "",
###   "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
###   "userId": 1
### }

### ============================================
### 9. Test multiple forgot password requests
### ============================================
### Should invalidate previous tokens
POST {{baseUrl}}/api/auth/forgot-password
Content-Type: application/json

{
  "email": "{{email}}"
}

### Wait a few seconds, then request again
POST {{baseUrl}}/api/auth/forgot-password
Content-Type: application/json

{
  "email": "{{email}}"
}

### The first token should now be invalidated (IsUsed = true)

