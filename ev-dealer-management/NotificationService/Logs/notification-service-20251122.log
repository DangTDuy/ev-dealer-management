2025-11-22 13:53:16.425 +07:00 [INF] Starting NotificationService...
2025-11-22 13:53:18.321 +07:00 [INF] NotificationService started successfully on http://localhost:5051
2025-11-22 13:53:19.634 +07:00 [INF] RabbitMQ consumer connection and channels initialized successfully.
2025-11-22 13:53:19.648 +07:00 [INF] RabbitMQ Consumer Hosted Service running.
2025-11-22 13:53:19.715 +07:00 [INF] Started consuming from queue: sales.completed
2025-11-22 13:53:19.717 +07:00 [INF] Started consuming from queue: vehicle.reserved
2025-11-22 13:53:19.719 +07:00 [INF] Started consuming from queue: testdrive.scheduled
2025-11-22 13:53:19.720 +07:00 [INF] Started consuming messages from all queues.
2025-11-22 14:02:05.040 +07:00 [WRN] Failed to determine the https port for redirect.
2025-11-22 14:02:07.272 +07:00 [ERR] Failed to send email to nguyendangchanell@gmail.com. Status: "Unauthorized". Response: {"errors":[{"message":"The provided authorization grant is invalid, expired, or revoked","field":null,"help":null}]}
2025-11-22 14:05:57.639 +07:00 [ERR] Failed to send email to nguyendangchanell@gmail.com. Status: "Unauthorized". Response: {"errors":[{"message":"The provided authorization grant is invalid, expired, or revoked","field":null,"help":null}]}
2025-11-22 14:08:50.060 +07:00 [ERR] Failed to send email to huynhdang1875@gmail.com. Status: "Unauthorized". Response: {"errors":[{"message":"The provided authorization grant is invalid, expired, or revoked","field":null,"help":null}]}
2025-11-22 14:10:38.104 +07:00 [ERR] Failed to send email to huynhdang1875@gmail.com. Status: "Unauthorized". Response: {"errors":[{"message":"The provided authorization grant is invalid, expired, or revoked","field":null,"help":null}]}
2025-11-22 14:40:16.605 +07:00 [ERR] Failed to send email to huynhdang1875@gmail.com. Status: "Forbidden". Response: {"errors":[{"message":"The from address does not match a verified Sender Identity. Mail cannot be sent until this error is resolved. Visit https://sendgrid.com/docs/for-developers/sending-email/sender-identity/ to see the Sender Identity requirements","field":"from","help":null}]}
2025-11-22 14:43:52.514 +07:00 [INF] RabbitMQ Consumer Hosted Service is stopping.
2025-11-22 14:43:52.514 +07:00 [INF] Stopping RabbitMQ consumer.
2025-11-22 14:43:52.564 +07:00 [INF] RabbitMQ consumer connection closed.
2025-11-22 14:43:52.574 +07:00 [FTL] NotificationService failed to start
System.Threading.Channels.ChannelClosedException: The channel has been closed.
   at System.Threading.Channels.ChannelWriter`1.Complete(Exception error)
   at RabbitMQ.Client.Framing.Impl.AutorecoveringConnection.StopRecoveryLoop()
   at RabbitMQ.Client.Framing.Impl.AutorecoveringConnection.Close()
   at NotificationService.Services.RabbitMQConsumerService.Dispose() in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Services\RabbitMQConsumerService.cs:line 192
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.DisposeAsync()
--- End of stack trace from previous location ---
   at Microsoft.Extensions.Hosting.Internal.Host.<DisposeAsync>g__DisposeAsync|21_0(Object o)
   at Microsoft.Extensions.Hosting.Internal.Host.DisposeAsync()
   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.RunAsync(IHost host, CancellationToken token)
   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.Run(IHost host)
   at Program.<Main>$(String[] args) in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Program.cs:line 64
2025-11-22 14:45:53.227 +07:00 [INF] Starting NotificationService...
2025-11-22 14:45:53.560 +07:00 [INF] NotificationService started successfully on http://localhost:5051
2025-11-22 14:45:53.711 +07:00 [INF] RabbitMQ consumer connection and channels initialized successfully.
2025-11-22 14:45:53.727 +07:00 [INF] RabbitMQ Consumer Hosted Service running.
2025-11-22 14:45:53.735 +07:00 [INF] Started consuming from queue: sales.completed
2025-11-22 14:45:53.743 +07:00 [INF] Started consuming from queue: vehicle.reserved
2025-11-22 14:45:53.748 +07:00 [INF] Started consuming from queue: testdrive.scheduled
2025-11-22 14:45:53.753 +07:00 [INF] Started consuming messages from all queues.
2025-11-22 14:46:18.150 +07:00 [WRN] Failed to determine the https port for redirect.
2025-11-22 14:46:27.745 +07:00 [ERR] Failed to send email to huynhdang1875@gmail.com. Status: "Forbidden". Response: {"errors":[{"message":"The from address does not match a verified Sender Identity. Mail cannot be sent until this error is resolved. Visit https://sendgrid.com/docs/for-developers/sending-email/sender-identity/ to see the Sender Identity requirements","field":"from","help":null}]}
2025-11-22 14:54:24.154 +07:00 [INF] RabbitMQ Consumer Hosted Service is stopping.
2025-11-22 14:54:24.154 +07:00 [INF] Stopping RabbitMQ consumer.
2025-11-22 14:54:24.168 +07:00 [INF] RabbitMQ consumer connection closed.
2025-11-22 14:54:24.175 +07:00 [FTL] NotificationService failed to start
System.Threading.Channels.ChannelClosedException: The channel has been closed.
   at System.Threading.Channels.ChannelWriter`1.Complete(Exception error)
   at RabbitMQ.Client.Framing.Impl.AutorecoveringConnection.StopRecoveryLoop()
   at RabbitMQ.Client.Framing.Impl.AutorecoveringConnection.Close()
   at NotificationService.Services.RabbitMQConsumerService.Dispose() in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Services\RabbitMQConsumerService.cs:line 192
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.DisposeAsync()
--- End of stack trace from previous location ---
   at Microsoft.Extensions.Hosting.Internal.Host.<DisposeAsync>g__DisposeAsync|21_0(Object o)
   at Microsoft.Extensions.Hosting.Internal.Host.DisposeAsync()
   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.RunAsync(IHost host, CancellationToken token)
   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.Run(IHost host)
   at Program.<Main>$(String[] args) in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Program.cs:line 64
2025-11-22 14:54:28.832 +07:00 [INF] Starting NotificationService...
2025-11-22 14:54:29.074 +07:00 [INF] NotificationService started successfully on http://localhost:5051
2025-11-22 14:54:29.222 +07:00 [INF] RabbitMQ consumer connection and channels initialized successfully.
2025-11-22 14:54:29.235 +07:00 [INF] RabbitMQ Consumer Hosted Service running.
2025-11-22 14:54:29.241 +07:00 [INF] Started consuming from queue: sales.completed
2025-11-22 14:54:29.243 +07:00 [INF] Started consuming from queue: vehicle.reserved
2025-11-22 14:54:29.245 +07:00 [INF] Started consuming from queue: testdrive.scheduled
2025-11-22 14:54:29.246 +07:00 [INF] Started consuming messages from all queues.
2025-11-22 14:54:32.511 +07:00 [WRN] Failed to determine the https port for redirect.
2025-11-22 14:54:35.251 +07:00 [INF] Email sent successfully to huynhdang1875@gmail.com. Subject: Test Email Swagger
2025-11-22 14:56:56.875 +07:00 [INF] Email sent successfully to huynhdang1872005@gmail.com. Subject: Test Email Swagger
2025-11-22 14:58:18.950 +07:00 [ERR] Error processing SaleCompletedEvent
System.Text.Json.JsonException: JSON deserialization for type 'NotificationService.DTOs.SaleCompletedEvent' was missing required properties including: 'OrderId', 'CustomerEmail', 'CustomerName', 'VehicleModel'.
   at System.Text.Json.ThrowHelper.ThrowJsonException_JsonRequiredPropertyMissing(JsonTypeInfo parent, BitArray requiredPropertiesSet)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryRead(Utf8JsonReader& reader, Type typeToConvert, JsonSerializerOptions options, ReadStack& state, T& value)
   at System.Text.Json.Serialization.JsonConverter`1.TryRead(Utf8JsonReader& reader, Type typeToConvert, JsonSerializerOptions options, ReadStack& state, T& value, Boolean& isPopulatedValue)
   at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader& reader, T& value, JsonSerializerOptions options, ReadStack& state)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.Deserialize(Utf8JsonReader& reader, ReadStack& state)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 utf8Json, JsonTypeInfo`1 jsonTypeInfo, Nullable`1 actualByteCount)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 json, JsonTypeInfo`1 jsonTypeInfo)
   at System.Text.Json.JsonSerializer.Deserialize[TValue](String json, JsonSerializerOptions options)
   at NotificationService.Consumers.SaleCompletedConsumer.HandleAsync(String message) in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Consumers\SaleCompletedConsumer.cs:line 21
2025-11-22 14:58:28.759 +07:00 [ERR] Error processing SaleCompletedEvent
System.Text.Json.JsonException: JSON deserialization for type 'NotificationService.DTOs.SaleCompletedEvent' was missing required properties including: 'OrderId', 'CustomerEmail', 'CustomerName', 'VehicleModel'.
   at System.Text.Json.ThrowHelper.ThrowJsonException_JsonRequiredPropertyMissing(JsonTypeInfo parent, BitArray requiredPropertiesSet)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryRead(Utf8JsonReader& reader, Type typeToConvert, JsonSerializerOptions options, ReadStack& state, T& value)
   at System.Text.Json.Serialization.JsonConverter`1.TryRead(Utf8JsonReader& reader, Type typeToConvert, JsonSerializerOptions options, ReadStack& state, T& value, Boolean& isPopulatedValue)
   at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader& reader, T& value, JsonSerializerOptions options, ReadStack& state)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.Deserialize(Utf8JsonReader& reader, ReadStack& state)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 utf8Json, JsonTypeInfo`1 jsonTypeInfo, Nullable`1 actualByteCount)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 json, JsonTypeInfo`1 jsonTypeInfo)
   at System.Text.Json.JsonSerializer.Deserialize[TValue](String json, JsonSerializerOptions options)
   at NotificationService.Consumers.SaleCompletedConsumer.HandleAsync(String message) in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Consumers\SaleCompletedConsumer.cs:line 21
2025-11-22 15:08:50.894 +07:00 [INF] Email sent successfully to huynhdang1875@gmail.com. Subject: Order Confirmation - EV Dealer Management
2025-11-22 15:08:56.549 +07:00 [INF] Email sent successfully to huynhdang1872005@gmail.com. Subject: Order Confirmation - EV Dealer Management
2025-11-22 15:09:51.315 +07:00 [INF] Email sent successfully to huynhdang1872005@gmail.com. Subject: Test Drive Confirmation - EV Dealer Management
2025-11-22 15:10:44.248 +07:00 [INF] Email sent successfully to khanhkietbt2020@gmail.com. Subject: Test Drive Confirmation - EV Dealer Management
2025-11-22 15:21:15.433 +07:00 [ERR] Exception occurred while sending SMS to +84346963416
Twilio.Exceptions.ApiException: Authenticate
   at Twilio.Clients.TwilioRestClient.ProcessResponse(Response response)
   at Twilio.Clients.TwilioRestClient.RequestAsync(Request request)
   at Twilio.Rest.Api.V2010.Account.MessageResource.CreateAsync(CreateMessageOptions options, ITwilioRestClient client)
   at Twilio.Rest.Api.V2010.Account.MessageResource.CreateAsync(PhoneNumber to, String pathAccountSid, PhoneNumber from, String messagingServiceSid, String body, List`1 mediaUrl, String contentSid, Uri statusCallback, String applicationSid, Nullable`1 maxPrice, Nullable`1 provideFeedback, Nullable`1 attempt, Nullable`1 validityPeriod, Nullable`1 forceDelivery, ContentRetentionEnum contentRetention, AddressRetentionEnum addressRetention, Nullable`1 smartEncoded, List`1 persistentAction, TrafficTypeEnum trafficType, Nullable`1 shortenUrls, ScheduleTypeEnum scheduleType, Nullable`1 sendAt, Nullable`1 sendAsMms, String contentVariables, RiskCheckEnum riskCheck, ITwilioRestClient client)
   at NotificationService.Services.SmsService.SendSmsAsync(String phoneNumber, String message) in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Services\SmsService.cs:line 27
2025-11-22 15:33:39.920 +07:00 [ERR] Exception occurred while sending SMS to +84346963416
Twilio.Exceptions.ApiException: Authenticate
   at Twilio.Clients.TwilioRestClient.ProcessResponse(Response response)
   at Twilio.Clients.TwilioRestClient.RequestAsync(Request request)
   at Twilio.Rest.Api.V2010.Account.MessageResource.CreateAsync(CreateMessageOptions options, ITwilioRestClient client)
   at Twilio.Rest.Api.V2010.Account.MessageResource.CreateAsync(PhoneNumber to, String pathAccountSid, PhoneNumber from, String messagingServiceSid, String body, List`1 mediaUrl, String contentSid, Uri statusCallback, String applicationSid, Nullable`1 maxPrice, Nullable`1 provideFeedback, Nullable`1 attempt, Nullable`1 validityPeriod, Nullable`1 forceDelivery, ContentRetentionEnum contentRetention, AddressRetentionEnum addressRetention, Nullable`1 smartEncoded, List`1 persistentAction, TrafficTypeEnum trafficType, Nullable`1 shortenUrls, ScheduleTypeEnum scheduleType, Nullable`1 sendAt, Nullable`1 sendAsMms, String contentVariables, RiskCheckEnum riskCheck, ITwilioRestClient client)
   at NotificationService.Services.SmsService.SendSmsAsync(String phoneNumber, String message) in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Services\SmsService.cs:line 27
2025-11-22 15:33:48.177 +07:00 [INF] RabbitMQ Consumer Hosted Service is stopping.
2025-11-22 15:33:48.177 +07:00 [INF] Stopping RabbitMQ consumer.
2025-11-22 15:33:48.196 +07:00 [INF] RabbitMQ consumer connection closed.
2025-11-22 15:33:48.200 +07:00 [FTL] NotificationService failed to start
System.Threading.Channels.ChannelClosedException: The channel has been closed.
   at System.Threading.Channels.ChannelWriter`1.Complete(Exception error)
   at RabbitMQ.Client.Framing.Impl.AutorecoveringConnection.StopRecoveryLoop()
   at RabbitMQ.Client.Framing.Impl.AutorecoveringConnection.Close()
   at NotificationService.Services.RabbitMQConsumerService.Dispose() in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Services\RabbitMQConsumerService.cs:line 192
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.DisposeAsync()
--- End of stack trace from previous location ---
   at Microsoft.Extensions.Hosting.Internal.Host.<DisposeAsync>g__DisposeAsync|21_0(Object o)
   at Microsoft.Extensions.Hosting.Internal.Host.DisposeAsync()
   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.RunAsync(IHost host, CancellationToken token)
   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.Run(IHost host)
   at Program.<Main>$(String[] args) in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Program.cs:line 64
2025-11-22 15:33:53.940 +07:00 [INF] Starting NotificationService...
2025-11-22 15:33:54.168 +07:00 [INF] NotificationService started successfully on http://localhost:5051
2025-11-22 15:33:54.291 +07:00 [INF] RabbitMQ consumer connection and channels initialized successfully.
2025-11-22 15:33:54.302 +07:00 [INF] RabbitMQ Consumer Hosted Service running.
2025-11-22 15:33:54.308 +07:00 [INF] Started consuming from queue: sales.completed
2025-11-22 15:33:54.311 +07:00 [INF] Started consuming from queue: vehicle.reserved
2025-11-22 15:33:54.313 +07:00 [INF] Started consuming from queue: testdrive.scheduled
2025-11-22 15:33:54.314 +07:00 [INF] Started consuming messages from all queues.
2025-11-22 15:34:04.693 +07:00 [WRN] Failed to determine the https port for redirect.
2025-11-22 15:34:05.667 +07:00 [ERR] Exception occurred while sending SMS to +84346963416
Twilio.Exceptions.ApiException: Authenticate
   at Twilio.Clients.TwilioRestClient.ProcessResponse(Response response)
   at Twilio.Clients.TwilioRestClient.RequestAsync(Request request)
   at Twilio.Rest.Api.V2010.Account.MessageResource.CreateAsync(CreateMessageOptions options, ITwilioRestClient client)
   at Twilio.Rest.Api.V2010.Account.MessageResource.CreateAsync(PhoneNumber to, String pathAccountSid, PhoneNumber from, String messagingServiceSid, String body, List`1 mediaUrl, String contentSid, Uri statusCallback, String applicationSid, Nullable`1 maxPrice, Nullable`1 provideFeedback, Nullable`1 attempt, Nullable`1 validityPeriod, Nullable`1 forceDelivery, ContentRetentionEnum contentRetention, AddressRetentionEnum addressRetention, Nullable`1 smartEncoded, List`1 persistentAction, TrafficTypeEnum trafficType, Nullable`1 shortenUrls, ScheduleTypeEnum scheduleType, Nullable`1 sendAt, Nullable`1 sendAsMms, String contentVariables, RiskCheckEnum riskCheck, ITwilioRestClient client)
   at NotificationService.Services.SmsService.SendSmsAsync(String phoneNumber, String message) in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Services\SmsService.cs:line 27
2025-11-22 15:34:21.763 +07:00 [ERR] Exception occurred while sending SMS to +84346963416
Twilio.Exceptions.ApiException: Authenticate
   at Twilio.Clients.TwilioRestClient.ProcessResponse(Response response)
   at Twilio.Clients.TwilioRestClient.RequestAsync(Request request)
   at Twilio.Rest.Api.V2010.Account.MessageResource.CreateAsync(CreateMessageOptions options, ITwilioRestClient client)
   at Twilio.Rest.Api.V2010.Account.MessageResource.CreateAsync(PhoneNumber to, String pathAccountSid, PhoneNumber from, String messagingServiceSid, String body, List`1 mediaUrl, String contentSid, Uri statusCallback, String applicationSid, Nullable`1 maxPrice, Nullable`1 provideFeedback, Nullable`1 attempt, Nullable`1 validityPeriod, Nullable`1 forceDelivery, ContentRetentionEnum contentRetention, AddressRetentionEnum addressRetention, Nullable`1 smartEncoded, List`1 persistentAction, TrafficTypeEnum trafficType, Nullable`1 shortenUrls, ScheduleTypeEnum scheduleType, Nullable`1 sendAt, Nullable`1 sendAsMms, String contentVariables, RiskCheckEnum riskCheck, ITwilioRestClient client)
   at NotificationService.Services.SmsService.SendSmsAsync(String phoneNumber, String message) in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Services\SmsService.cs:line 27
2025-11-22 15:37:24.058 +07:00 [INF] RabbitMQ Consumer Hosted Service is stopping.
2025-11-22 15:37:24.059 +07:00 [INF] Stopping RabbitMQ consumer.
2025-11-22 15:37:24.073 +07:00 [INF] RabbitMQ consumer connection closed.
2025-11-22 15:37:24.077 +07:00 [FTL] NotificationService failed to start
System.Threading.Channels.ChannelClosedException: The channel has been closed.
   at System.Threading.Channels.ChannelWriter`1.Complete(Exception error)
   at RabbitMQ.Client.Framing.Impl.AutorecoveringConnection.StopRecoveryLoop()
   at RabbitMQ.Client.Framing.Impl.AutorecoveringConnection.Close()
   at NotificationService.Services.RabbitMQConsumerService.Dispose() in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Services\RabbitMQConsumerService.cs:line 192
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.DisposeAsync()
--- End of stack trace from previous location ---
   at Microsoft.Extensions.Hosting.Internal.Host.<DisposeAsync>g__DisposeAsync|21_0(Object o)
   at Microsoft.Extensions.Hosting.Internal.Host.DisposeAsync()
   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.RunAsync(IHost host, CancellationToken token)
   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.Run(IHost host)
   at Program.<Main>$(String[] args) in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Program.cs:line 64
2025-11-22 15:37:32.579 +07:00 [INF] Starting NotificationService...
2025-11-22 15:37:32.892 +07:00 [INF] NotificationService started successfully on http://localhost:5051
2025-11-22 15:37:33.010 +07:00 [INF] RabbitMQ consumer connection and channels initialized successfully.
2025-11-22 15:37:33.021 +07:00 [INF] RabbitMQ Consumer Hosted Service running.
2025-11-22 15:37:33.026 +07:00 [INF] Started consuming from queue: sales.completed
2025-11-22 15:37:33.029 +07:00 [INF] Started consuming from queue: vehicle.reserved
2025-11-22 15:37:33.031 +07:00 [INF] Started consuming from queue: testdrive.scheduled
2025-11-22 15:37:33.032 +07:00 [INF] Started consuming messages from all queues.
2025-11-22 15:37:36.275 +07:00 [WRN] Failed to determine the https port for redirect.
2025-11-22 15:37:37.322 +07:00 [ERR] Exception occurred while sending SMS to +84346963416
Twilio.Exceptions.ApiException: The number +8434696XXXX is unverified. Trial accounts cannot send messages to unverified numbers; verify +8434696XXXX at twilio.com/user/account/phone-numbers/verified, or purchase a Twilio number to send messages to unverified numbers
   at Twilio.Clients.TwilioRestClient.ProcessResponse(Response response)
   at Twilio.Clients.TwilioRestClient.RequestAsync(Request request)
   at Twilio.Rest.Api.V2010.Account.MessageResource.CreateAsync(CreateMessageOptions options, ITwilioRestClient client)
   at Twilio.Rest.Api.V2010.Account.MessageResource.CreateAsync(PhoneNumber to, String pathAccountSid, PhoneNumber from, String messagingServiceSid, String body, List`1 mediaUrl, String contentSid, Uri statusCallback, String applicationSid, Nullable`1 maxPrice, Nullable`1 provideFeedback, Nullable`1 attempt, Nullable`1 validityPeriod, Nullable`1 forceDelivery, ContentRetentionEnum contentRetention, AddressRetentionEnum addressRetention, Nullable`1 smartEncoded, List`1 persistentAction, TrafficTypeEnum trafficType, Nullable`1 shortenUrls, ScheduleTypeEnum scheduleType, Nullable`1 sendAt, Nullable`1 sendAsMms, String contentVariables, RiskCheckEnum riskCheck, ITwilioRestClient client)
   at NotificationService.Services.SmsService.SendSmsAsync(String phoneNumber, String message) in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Services\SmsService.cs:line 27
2025-11-22 15:37:58.414 +07:00 [ERR] Exception occurred while sending SMS to 0346963416
Twilio.Exceptions.ApiException: Invalid 'To' Phone Number: 034696XXXX
   at Twilio.Clients.TwilioRestClient.ProcessResponse(Response response)
   at Twilio.Clients.TwilioRestClient.RequestAsync(Request request)
   at Twilio.Rest.Api.V2010.Account.MessageResource.CreateAsync(CreateMessageOptions options, ITwilioRestClient client)
   at Twilio.Rest.Api.V2010.Account.MessageResource.CreateAsync(PhoneNumber to, String pathAccountSid, PhoneNumber from, String messagingServiceSid, String body, List`1 mediaUrl, String contentSid, Uri statusCallback, String applicationSid, Nullable`1 maxPrice, Nullable`1 provideFeedback, Nullable`1 attempt, Nullable`1 validityPeriod, Nullable`1 forceDelivery, ContentRetentionEnum contentRetention, AddressRetentionEnum addressRetention, Nullable`1 smartEncoded, List`1 persistentAction, TrafficTypeEnum trafficType, Nullable`1 shortenUrls, ScheduleTypeEnum scheduleType, Nullable`1 sendAt, Nullable`1 sendAsMms, String contentVariables, RiskCheckEnum riskCheck, ITwilioRestClient client)
   at NotificationService.Services.SmsService.SendSmsAsync(String phoneNumber, String message) in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Services\SmsService.cs:line 27
2025-11-22 15:38:07.287 +07:00 [INF] RabbitMQ Consumer Hosted Service is stopping.
2025-11-22 15:38:07.287 +07:00 [INF] Stopping RabbitMQ consumer.
2025-11-22 15:38:07.304 +07:00 [INF] RabbitMQ consumer connection closed.
2025-11-22 15:38:07.309 +07:00 [FTL] NotificationService failed to start
System.Threading.Channels.ChannelClosedException: The channel has been closed.
   at System.Threading.Channels.ChannelWriter`1.Complete(Exception error)
   at RabbitMQ.Client.Framing.Impl.AutorecoveringConnection.StopRecoveryLoop()
   at RabbitMQ.Client.Framing.Impl.AutorecoveringConnection.Close()
   at NotificationService.Services.RabbitMQConsumerService.Dispose() in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Services\RabbitMQConsumerService.cs:line 192
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.DisposeAsync()
--- End of stack trace from previous location ---
   at Microsoft.Extensions.Hosting.Internal.Host.<DisposeAsync>g__DisposeAsync|21_0(Object o)
   at Microsoft.Extensions.Hosting.Internal.Host.DisposeAsync()
   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.RunAsync(IHost host, CancellationToken token)
   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.Run(IHost host)
   at Program.<Main>$(String[] args) in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Program.cs:line 64
2025-11-22 15:43:56.463 +07:00 [INF] Starting NotificationService...
2025-11-22 15:43:56.863 +07:00 [INF] NotificationService started successfully on http://localhost:5051
2025-11-22 15:43:57.139 +07:00 [INF] RabbitMQ consumer connection and channels initialized successfully.
2025-11-22 15:43:57.154 +07:00 [INF] RabbitMQ Consumer Hosted Service running.
2025-11-22 15:43:57.172 +07:00 [INF] Started consuming from queue: sales.completed
2025-11-22 15:43:57.182 +07:00 [INF] Started consuming from queue: vehicle.reserved
2025-11-22 15:43:57.188 +07:00 [INF] Started consuming from queue: testdrive.scheduled
2025-11-22 15:43:57.198 +07:00 [INF] Started consuming messages from all queues.
2025-11-22 15:44:19.349 +07:00 [WRN] Failed to determine the https port for redirect.
2025-11-22 15:44:20.363 +07:00 [ERR] Exception occurred while sending SMS to 0346963416
Twilio.Exceptions.ApiException: Invalid 'To' Phone Number: 034696XXXX
   at Twilio.Clients.TwilioRestClient.ProcessResponse(Response response)
   at Twilio.Clients.TwilioRestClient.RequestAsync(Request request)
   at Twilio.Rest.Api.V2010.Account.MessageResource.CreateAsync(CreateMessageOptions options, ITwilioRestClient client)
   at Twilio.Rest.Api.V2010.Account.MessageResource.CreateAsync(PhoneNumber to, String pathAccountSid, PhoneNumber from, String messagingServiceSid, String body, List`1 mediaUrl, String contentSid, Uri statusCallback, String applicationSid, Nullable`1 maxPrice, Nullable`1 provideFeedback, Nullable`1 attempt, Nullable`1 validityPeriod, Nullable`1 forceDelivery, ContentRetentionEnum contentRetention, AddressRetentionEnum addressRetention, Nullable`1 smartEncoded, List`1 persistentAction, TrafficTypeEnum trafficType, Nullable`1 shortenUrls, ScheduleTypeEnum scheduleType, Nullable`1 sendAt, Nullable`1 sendAsMms, String contentVariables, RiskCheckEnum riskCheck, ITwilioRestClient client)
   at NotificationService.Services.SmsService.SendSmsAsync(String phoneNumber, String message) in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Services\SmsService.cs:line 27
2025-11-22 15:45:56.100 +07:00 [ERR] Exception occurred while sending SMS to +84346963416
Twilio.Exceptions.ApiException: The number +8434696XXXX is unverified. Trial accounts cannot send messages to unverified numbers; verify +8434696XXXX at twilio.com/user/account/phone-numbers/verified, or purchase a Twilio number to send messages to unverified numbers
   at Twilio.Clients.TwilioRestClient.ProcessResponse(Response response)
   at Twilio.Clients.TwilioRestClient.RequestAsync(Request request)
   at Twilio.Rest.Api.V2010.Account.MessageResource.CreateAsync(CreateMessageOptions options, ITwilioRestClient client)
   at Twilio.Rest.Api.V2010.Account.MessageResource.CreateAsync(PhoneNumber to, String pathAccountSid, PhoneNumber from, String messagingServiceSid, String body, List`1 mediaUrl, String contentSid, Uri statusCallback, String applicationSid, Nullable`1 maxPrice, Nullable`1 provideFeedback, Nullable`1 attempt, Nullable`1 validityPeriod, Nullable`1 forceDelivery, ContentRetentionEnum contentRetention, AddressRetentionEnum addressRetention, Nullable`1 smartEncoded, List`1 persistentAction, TrafficTypeEnum trafficType, Nullable`1 shortenUrls, ScheduleTypeEnum scheduleType, Nullable`1 sendAt, Nullable`1 sendAsMms, String contentVariables, RiskCheckEnum riskCheck, ITwilioRestClient client)
   at NotificationService.Services.SmsService.SendSmsAsync(String phoneNumber, String message) in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Services\SmsService.cs:line 27
2025-11-22 15:48:17.004 +07:00 [INF] RabbitMQ Consumer Hosted Service is stopping.
2025-11-22 15:48:17.004 +07:00 [INF] Stopping RabbitMQ consumer.
2025-11-22 15:48:17.019 +07:00 [INF] RabbitMQ consumer connection closed.
2025-11-22 15:48:17.024 +07:00 [FTL] NotificationService failed to start
System.Threading.Channels.ChannelClosedException: The channel has been closed.
   at System.Threading.Channels.ChannelWriter`1.Complete(Exception error)
   at RabbitMQ.Client.Framing.Impl.AutorecoveringConnection.StopRecoveryLoop()
   at RabbitMQ.Client.Framing.Impl.AutorecoveringConnection.Close()
   at NotificationService.Services.RabbitMQConsumerService.Dispose() in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Services\RabbitMQConsumerService.cs:line 192
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.DisposeAsync()
--- End of stack trace from previous location ---
   at Microsoft.Extensions.Hosting.Internal.Host.<DisposeAsync>g__DisposeAsync|21_0(Object o)
   at Microsoft.Extensions.Hosting.Internal.Host.DisposeAsync()
   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.RunAsync(IHost host, CancellationToken token)
   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.Run(IHost host)
   at Program.<Main>$(String[] args) in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Program.cs:line 64
2025-11-22 15:49:46.900 +07:00 [INF] Starting NotificationService...
2025-11-22 15:49:54.581 +07:00 [INF] NotificationService started successfully on http://localhost:5051
2025-11-22 15:49:54.852 +07:00 [INF] RabbitMQ consumer connection and channels initialized successfully.
2025-11-22 15:49:54.864 +07:00 [INF] RabbitMQ Consumer Hosted Service running.
2025-11-22 15:49:54.876 +07:00 [INF] Started consuming from queue: sales.completed
2025-11-22 15:49:54.885 +07:00 [INF] Started consuming from queue: vehicle.reserved
2025-11-22 15:49:54.889 +07:00 [INF] Started consuming from queue: testdrive.scheduled
2025-11-22 15:49:54.891 +07:00 [INF] Started consuming messages from all queues.
2025-11-22 15:50:01.005 +07:00 [WRN] Failed to determine the https port for redirect.
2025-11-22 15:50:01.026 +07:00 [INF] Twilio Initialized with Account: AC2a126b961929014d46089b8f79a0e100
2025-11-22 15:50:02.247 +07:00 [ERR] Exception occurred while sending SMS to +84346963416
Twilio.Exceptions.ApiException: The number +8434696XXXX is unverified. Trial accounts cannot send messages to unverified numbers; verify +8434696XXXX at twilio.com/user/account/phone-numbers/verified, or purchase a Twilio number to send messages to unverified numbers
   at Twilio.Clients.TwilioRestClient.ProcessResponse(Response response)
   at Twilio.Clients.TwilioRestClient.RequestAsync(Request request)
   at Twilio.Rest.Api.V2010.Account.MessageResource.CreateAsync(CreateMessageOptions options, ITwilioRestClient client)
   at Twilio.Rest.Api.V2010.Account.MessageResource.CreateAsync(PhoneNumber to, String pathAccountSid, PhoneNumber from, String messagingServiceSid, String body, List`1 mediaUrl, String contentSid, Uri statusCallback, String applicationSid, Nullable`1 maxPrice, Nullable`1 provideFeedback, Nullable`1 attempt, Nullable`1 validityPeriod, Nullable`1 forceDelivery, ContentRetentionEnum contentRetention, AddressRetentionEnum addressRetention, Nullable`1 smartEncoded, List`1 persistentAction, TrafficTypeEnum trafficType, Nullable`1 shortenUrls, ScheduleTypeEnum scheduleType, Nullable`1 sendAt, Nullable`1 sendAsMms, String contentVariables, RiskCheckEnum riskCheck, ITwilioRestClient client)
   at NotificationService.Services.SmsService.SendSmsAsync(String phoneNumber, String message) in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Services\SmsService.cs:line 40
2025-11-22 16:05:21.992 +07:00 [ERR] Error processing SaleCompletedEvent
System.Text.Json.JsonException: '/' is an invalid start of a property name. Expected a '"'. Path: $ | LineNumber: 2 | BytePositionInLine: 50.
 ---> System.Text.Json.JsonReaderException: '/' is an invalid start of a property name. Expected a '"'. LineNumber: 2 | BytePositionInLine: 50.
   at System.Text.Json.ThrowHelper.ThrowJsonReaderException(Utf8JsonReader& json, ExceptionResource resource, Byte nextByte, ReadOnlySpan`1 bytes)
   at System.Text.Json.Utf8JsonReader.ConsumeNextToken(Byte marker)
   at System.Text.Json.Utf8JsonReader.ReadSingleSegment()
   at System.Text.Json.Utf8JsonReader.Read()
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryRead(Utf8JsonReader& reader, Type typeToConvert, JsonSerializerOptions options, ReadStack& state, T& value)
   at System.Text.Json.Serialization.JsonConverter`1.TryRead(Utf8JsonReader& reader, Type typeToConvert, JsonSerializerOptions options, ReadStack& state, T& value, Boolean& isPopulatedValue)
   at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader& reader, T& value, JsonSerializerOptions options, ReadStack& state)
   --- End of inner exception stack trace ---
   at System.Text.Json.ThrowHelper.ReThrowWithPath(ReadStack& state, JsonReaderException ex)
   at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader& reader, T& value, JsonSerializerOptions options, ReadStack& state)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.Deserialize(Utf8JsonReader& reader, ReadStack& state)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 utf8Json, JsonTypeInfo`1 jsonTypeInfo, Nullable`1 actualByteCount)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 json, JsonTypeInfo`1 jsonTypeInfo)
   at System.Text.Json.JsonSerializer.Deserialize[TValue](String json, JsonSerializerOptions options)
   at NotificationService.Consumers.SaleCompletedConsumer.HandleAsync(String message) in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Consumers\SaleCompletedConsumer.cs:line 21
2025-11-22 16:05:22.002 +07:00 [ERR] Error processing SaleCompletedEvent
System.Text.Json.JsonException: '/' is an invalid start of a property name. Expected a '"'. Path: $ | LineNumber: 2 | BytePositionInLine: 50.
 ---> System.Text.Json.JsonReaderException: '/' is an invalid start of a property name. Expected a '"'. LineNumber: 2 | BytePositionInLine: 50.
   at System.Text.Json.ThrowHelper.ThrowJsonReaderException(Utf8JsonReader& json, ExceptionResource resource, Byte nextByte, ReadOnlySpan`1 bytes)
   at System.Text.Json.Utf8JsonReader.ConsumeNextToken(Byte marker)
   at System.Text.Json.Utf8JsonReader.ReadSingleSegment()
   at System.Text.Json.Utf8JsonReader.Read()
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryRead(Utf8JsonReader& reader, Type typeToConvert, JsonSerializerOptions options, ReadStack& state, T& value)
   at System.Text.Json.Serialization.JsonConverter`1.TryRead(Utf8JsonReader& reader, Type typeToConvert, JsonSerializerOptions options, ReadStack& state, T& value, Boolean& isPopulatedValue)
   at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader& reader, T& value, JsonSerializerOptions options, ReadStack& state)
   --- End of inner exception stack trace ---
   at System.Text.Json.ThrowHelper.ReThrowWithPath(ReadStack& state, JsonReaderException ex)
   at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader& reader, T& value, JsonSerializerOptions options, ReadStack& state)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.Deserialize(Utf8JsonReader& reader, ReadStack& state)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 utf8Json, JsonTypeInfo`1 jsonTypeInfo, Nullable`1 actualByteCount)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 json, JsonTypeInfo`1 jsonTypeInfo)
   at System.Text.Json.JsonSerializer.Deserialize[TValue](String json, JsonSerializerOptions options)
   at NotificationService.Consumers.SaleCompletedConsumer.HandleAsync(String message) in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Consumers\SaleCompletedConsumer.cs:line 21
2025-11-22 16:07:18.087 +07:00 [ERR] Error processing SaleCompletedEvent
System.Text.Json.JsonException: JSON deserialization for type 'NotificationService.DTOs.SaleCompletedEvent' was missing required properties including: 'OrderId', 'CustomerEmail', 'CustomerName', 'VehicleModel'.
   at System.Text.Json.ThrowHelper.ThrowJsonException_JsonRequiredPropertyMissing(JsonTypeInfo parent, BitArray requiredPropertiesSet)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryRead(Utf8JsonReader& reader, Type typeToConvert, JsonSerializerOptions options, ReadStack& state, T& value)
   at System.Text.Json.Serialization.JsonConverter`1.TryRead(Utf8JsonReader& reader, Type typeToConvert, JsonSerializerOptions options, ReadStack& state, T& value, Boolean& isPopulatedValue)
   at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader& reader, T& value, JsonSerializerOptions options, ReadStack& state)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.Deserialize(Utf8JsonReader& reader, ReadStack& state)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 utf8Json, JsonTypeInfo`1 jsonTypeInfo, Nullable`1 actualByteCount)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 json, JsonTypeInfo`1 jsonTypeInfo)
   at System.Text.Json.JsonSerializer.Deserialize[TValue](String json, JsonSerializerOptions options)
   at NotificationService.Consumers.SaleCompletedConsumer.HandleAsync(String message) in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Consumers\SaleCompletedConsumer.cs:line 21
2025-11-22 16:07:49.329 +07:00 [ERR] Error processing SaleCompletedEvent
System.Text.Json.JsonException: JSON deserialization for type 'NotificationService.DTOs.SaleCompletedEvent' was missing required properties including: 'OrderId', 'CustomerEmail', 'CustomerName', 'VehicleModel'.
   at System.Text.Json.ThrowHelper.ThrowJsonException_JsonRequiredPropertyMissing(JsonTypeInfo parent, BitArray requiredPropertiesSet)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryRead(Utf8JsonReader& reader, Type typeToConvert, JsonSerializerOptions options, ReadStack& state, T& value)
   at System.Text.Json.Serialization.JsonConverter`1.TryRead(Utf8JsonReader& reader, Type typeToConvert, JsonSerializerOptions options, ReadStack& state, T& value, Boolean& isPopulatedValue)
   at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader& reader, T& value, JsonSerializerOptions options, ReadStack& state)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.Deserialize(Utf8JsonReader& reader, ReadStack& state)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 utf8Json, JsonTypeInfo`1 jsonTypeInfo, Nullable`1 actualByteCount)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 json, JsonTypeInfo`1 jsonTypeInfo)
   at System.Text.Json.JsonSerializer.Deserialize[TValue](String json, JsonSerializerOptions options)
   at NotificationService.Consumers.SaleCompletedConsumer.HandleAsync(String message) in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Consumers\SaleCompletedConsumer.cs:line 21
2025-11-22 16:08:42.760 +07:00 [INF] Processing SaleCompletedEvent for Order: DON-HANG-CHOT-HA
2025-11-22 16:08:43.893 +07:00 [INF] Email sent successfully to huynhdang1872005@gmail.com. Subject: Order Confirmation - EV Dealer Management
2025-11-22 16:08:43.894 +07:00 [INF] Order confirmation email sent for Order: DON-HANG-CHOT-HA
2025-11-22 16:10:06.144 +07:00 [INF] Twilio Initialized with Account: AC2a126b961929014d46089b8f79a0e100
2025-11-22 16:10:06.157 +07:00 [INF] Processing VehicleReservedEvent for Reservation: RES-MOCK-001
2025-11-22 16:10:06.980 +07:00 [ERR] Exception occurred while sending SMS to +84909999999
Twilio.Exceptions.ApiException: The number +8490999XXXX is unverified. Trial accounts cannot send messages to unverified numbers; verify +8490999XXXX at twilio.com/user/account/phone-numbers/verified, or purchase a Twilio number to send messages to unverified numbers
   at Twilio.Clients.TwilioRestClient.ProcessResponse(Response response)
   at Twilio.Clients.TwilioRestClient.RequestAsync(Request request)
   at Twilio.Rest.Api.V2010.Account.MessageResource.CreateAsync(CreateMessageOptions options, ITwilioRestClient client)
   at Twilio.Rest.Api.V2010.Account.MessageResource.CreateAsync(PhoneNumber to, String pathAccountSid, PhoneNumber from, String messagingServiceSid, String body, List`1 mediaUrl, String contentSid, Uri statusCallback, String applicationSid, Nullable`1 maxPrice, Nullable`1 provideFeedback, Nullable`1 attempt, Nullable`1 validityPeriod, Nullable`1 forceDelivery, ContentRetentionEnum contentRetention, AddressRetentionEnum addressRetention, Nullable`1 smartEncoded, List`1 persistentAction, TrafficTypeEnum trafficType, Nullable`1 shortenUrls, ScheduleTypeEnum scheduleType, Nullable`1 sendAt, Nullable`1 sendAsMms, String contentVariables, RiskCheckEnum riskCheck, ITwilioRestClient client)
   at NotificationService.Services.SmsService.SendSmsAsync(String phoneNumber, String message) in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Services\SmsService.cs:line 40
2025-11-22 16:10:06.983 +07:00 [ERR] Failed to send reservation confirmation SMS for Reservation: RES-MOCK-001
2025-11-22 16:11:06.608 +07:00 [INF] Twilio Initialized with Account: AC2a126b961929014d46089b8f79a0e100
2025-11-22 16:11:06.610 +07:00 [INF] Processing VehicleReservedEvent for Reservation: 238
2025-11-22 16:11:06.991 +07:00 [ERR] Exception occurred while sending SMS to +84909999999
Twilio.Exceptions.ApiException: The number +8490999XXXX is unverified. Trial accounts cannot send messages to unverified numbers; verify +8490999XXXX at twilio.com/user/account/phone-numbers/verified, or purchase a Twilio number to send messages to unverified numbers
   at Twilio.Clients.TwilioRestClient.ProcessResponse(Response response)
   at Twilio.Clients.TwilioRestClient.RequestAsync(Request request)
   at Twilio.Rest.Api.V2010.Account.MessageResource.CreateAsync(CreateMessageOptions options, ITwilioRestClient client)
   at Twilio.Rest.Api.V2010.Account.MessageResource.CreateAsync(PhoneNumber to, String pathAccountSid, PhoneNumber from, String messagingServiceSid, String body, List`1 mediaUrl, String contentSid, Uri statusCallback, String applicationSid, Nullable`1 maxPrice, Nullable`1 provideFeedback, Nullable`1 attempt, Nullable`1 validityPeriod, Nullable`1 forceDelivery, ContentRetentionEnum contentRetention, AddressRetentionEnum addressRetention, Nullable`1 smartEncoded, List`1 persistentAction, TrafficTypeEnum trafficType, Nullable`1 shortenUrls, ScheduleTypeEnum scheduleType, Nullable`1 sendAt, Nullable`1 sendAsMms, String contentVariables, RiskCheckEnum riskCheck, ITwilioRestClient client)
   at NotificationService.Services.SmsService.SendSmsAsync(String phoneNumber, String message) in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Services\SmsService.cs:line 40
2025-11-22 16:11:06.993 +07:00 [ERR] Failed to send reservation confirmation SMS for Reservation: 238
2025-11-22 16:11:56.944 +07:00 [INF] Twilio Initialized with Account: AC2a126b961929014d46089b8f79a0e100
2025-11-22 16:11:56.946 +07:00 [INF] Processing VehicleReservedEvent for Reservation: 238
2025-11-22 16:11:57.368 +07:00 [ERR] Exception occurred while sending SMS to +84909999999
Twilio.Exceptions.ApiException: The number +8490999XXXX is unverified. Trial accounts cannot send messages to unverified numbers; verify +8490999XXXX at twilio.com/user/account/phone-numbers/verified, or purchase a Twilio number to send messages to unverified numbers
   at Twilio.Clients.TwilioRestClient.ProcessResponse(Response response)
   at Twilio.Clients.TwilioRestClient.RequestAsync(Request request)
   at Twilio.Rest.Api.V2010.Account.MessageResource.CreateAsync(CreateMessageOptions options, ITwilioRestClient client)
   at Twilio.Rest.Api.V2010.Account.MessageResource.CreateAsync(PhoneNumber to, String pathAccountSid, PhoneNumber from, String messagingServiceSid, String body, List`1 mediaUrl, String contentSid, Uri statusCallback, String applicationSid, Nullable`1 maxPrice, Nullable`1 provideFeedback, Nullable`1 attempt, Nullable`1 validityPeriod, Nullable`1 forceDelivery, ContentRetentionEnum contentRetention, AddressRetentionEnum addressRetention, Nullable`1 smartEncoded, List`1 persistentAction, TrafficTypeEnum trafficType, Nullable`1 shortenUrls, ScheduleTypeEnum scheduleType, Nullable`1 sendAt, Nullable`1 sendAsMms, String contentVariables, RiskCheckEnum riskCheck, ITwilioRestClient client)
   at NotificationService.Services.SmsService.SendSmsAsync(String phoneNumber, String message) in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Services\SmsService.cs:line 40
2025-11-22 16:11:57.370 +07:00 [ERR] Failed to send reservation confirmation SMS for Reservation: 238
2025-11-22 16:12:11.714 +07:00 [INF] Twilio Initialized with Account: AC2a126b961929014d46089b8f79a0e100
2025-11-22 16:12:11.716 +07:00 [INF] Processing VehicleReservedEvent for Reservation: RES-MOCK-LAN-2
2025-11-22 16:12:12.094 +07:00 [ERR] Exception occurred while sending SMS to +84909999999
Twilio.Exceptions.ApiException: The number +8490999XXXX is unverified. Trial accounts cannot send messages to unverified numbers; verify +8490999XXXX at twilio.com/user/account/phone-numbers/verified, or purchase a Twilio number to send messages to unverified numbers
   at Twilio.Clients.TwilioRestClient.ProcessResponse(Response response)
   at Twilio.Clients.TwilioRestClient.RequestAsync(Request request)
   at Twilio.Rest.Api.V2010.Account.MessageResource.CreateAsync(CreateMessageOptions options, ITwilioRestClient client)
   at Twilio.Rest.Api.V2010.Account.MessageResource.CreateAsync(PhoneNumber to, String pathAccountSid, PhoneNumber from, String messagingServiceSid, String body, List`1 mediaUrl, String contentSid, Uri statusCallback, String applicationSid, Nullable`1 maxPrice, Nullable`1 provideFeedback, Nullable`1 attempt, Nullable`1 validityPeriod, Nullable`1 forceDelivery, ContentRetentionEnum contentRetention, AddressRetentionEnum addressRetention, Nullable`1 smartEncoded, List`1 persistentAction, TrafficTypeEnum trafficType, Nullable`1 shortenUrls, ScheduleTypeEnum scheduleType, Nullable`1 sendAt, Nullable`1 sendAsMms, String contentVariables, RiskCheckEnum riskCheck, ITwilioRestClient client)
   at NotificationService.Services.SmsService.SendSmsAsync(String phoneNumber, String message) in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Services\SmsService.cs:line 40
2025-11-22 16:12:12.096 +07:00 [ERR] Failed to send reservation confirmation SMS for Reservation: RES-MOCK-LAN-2
2025-11-22 16:12:15.507 +07:00 [INF] RabbitMQ Consumer Hosted Service is stopping.
2025-11-22 16:12:15.508 +07:00 [INF] Stopping RabbitMQ consumer.
2025-11-22 16:12:15.520 +07:00 [INF] RabbitMQ consumer connection closed.
2025-11-22 16:12:15.525 +07:00 [FTL] NotificationService failed to start
System.Threading.Channels.ChannelClosedException: The channel has been closed.
   at System.Threading.Channels.ChannelWriter`1.Complete(Exception error)
   at RabbitMQ.Client.Framing.Impl.AutorecoveringConnection.StopRecoveryLoop()
   at RabbitMQ.Client.Framing.Impl.AutorecoveringConnection.Close()
   at NotificationService.Services.RabbitMQConsumerService.Dispose() in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Services\RabbitMQConsumerService.cs:line 192
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.DisposeAsync()
--- End of stack trace from previous location ---
   at Microsoft.Extensions.Hosting.Internal.Host.<DisposeAsync>g__DisposeAsync|21_0(Object o)
   at Microsoft.Extensions.Hosting.Internal.Host.DisposeAsync()
   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.RunAsync(IHost host, CancellationToken token)
   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.Run(IHost host)
   at Program.<Main>$(String[] args) in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Program.cs:line 64
2025-11-22 16:12:47.322 +07:00 [INF] Starting NotificationService...
2025-11-22 16:12:48.314 +07:00 [INF] NotificationService started successfully on http://localhost:5051
2025-11-22 16:12:48.556 +07:00 [INF] RabbitMQ consumer connection and channels initialized successfully.
2025-11-22 16:12:48.571 +07:00 [INF] RabbitMQ Consumer Hosted Service running.
2025-11-22 16:12:48.577 +07:00 [INF] Started consuming from queue: sales.completed
2025-11-22 16:12:48.579 +07:00 [INF] Started consuming from queue: vehicle.reserved
2025-11-22 16:12:48.581 +07:00 [INF] Started consuming from queue: testdrive.scheduled
2025-11-22 16:12:48.582 +07:00 [INF] Started consuming messages from all queues.
2025-11-22 16:12:53.153 +07:00 [INF] SmsService started in MOCK mode (Gia lap).
2025-11-22 16:12:53.214 +07:00 [INF] Processing VehicleReservedEvent for Reservation: RES-MOCK-LAN-2
2025-11-22 16:12:53.217 +07:00 [INF] Mock SMS sent to +84909999999
2025-11-22 16:12:53.218 +07:00 [INF] Reservation confirmation SMS sent for Reservation: RES-MOCK-LAN-2
2025-11-22 16:13:11.613 +07:00 [INF] SmsService started in MOCK mode (Gia lap).
2025-11-22 16:13:11.615 +07:00 [INF] Processing VehicleReservedEvent for Reservation: RES-MOCK-LAN-2
2025-11-22 16:13:11.616 +07:00 [INF] Mock SMS sent to +8446963416
2025-11-22 16:13:11.616 +07:00 [INF] Reservation confirmation SMS sent for Reservation: RES-MOCK-LAN-2
2025-11-22 16:54:43.675 +07:00 [INF] RabbitMQ Consumer Hosted Service is stopping.
2025-11-22 16:54:43.690 +07:00 [INF] Stopping RabbitMQ consumer.
2025-11-22 16:54:43.782 +07:00 [INF] RabbitMQ consumer connection closed.
2025-11-22 16:54:43.874 +07:00 [FTL] NotificationService failed to start
System.Threading.Channels.ChannelClosedException: The channel has been closed.
   at System.Threading.Channels.ChannelWriter`1.Complete(Exception error)
   at RabbitMQ.Client.Framing.Impl.AutorecoveringConnection.StopRecoveryLoop()
   at RabbitMQ.Client.Framing.Impl.AutorecoveringConnection.Close()
   at NotificationService.Services.RabbitMQConsumerService.Dispose() in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Services\RabbitMQConsumerService.cs:line 192
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.DisposeAsync()
--- End of stack trace from previous location ---
   at Microsoft.Extensions.Hosting.Internal.Host.<DisposeAsync>g__DisposeAsync|21_0(Object o)
   at Microsoft.Extensions.Hosting.Internal.Host.DisposeAsync()
   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.RunAsync(IHost host, CancellationToken token)
   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.Run(IHost host)
   at Program.<Main>$(String[] args) in D:\Nam_3\ev-dealer-management\ev-dealer-management\NotificationService\Program.cs:line 64
